# Programming for Social Scientists: Core Skills 

## _Assignment 2 – Planning for Drunks_

## Supporting Document



### **Intention of the project** 

The aim of the project is to simulate 25 numbered drunks leaving a pub in a small town and walking to their associated home. They cannot walk through buildings and bounce off town perimeters, or ‘walls’. The buildings have specific exit and entrance points, or ‘doors’, to simulate a closer representation of reality. The drunks know where their house is, but initially move mostly randomly to imitate lingering round the pub entrance as people leave. They continue to move like this until they are within a close proximity to their door. This is to represent a drunken walk which becomes more structured as they see their house and become more aware of their surroundings, and less distracted by fellow drunks. As they move, their paths are saved to a 2D list which matches the dimensions of the town plan (300x300). This list is subsequently plotted as a heat map to graphically represent the routes taken to reach their homes. 



### **Issues and improvements**  

The code has no known issues integral to its running ability. However, there are a few improvements that could be made. Firstly, the animation runs for a set number of iterations even though the time taken for the drunks to get home is uncertain. This means if you wish to run the animation (not necessary for finished product) you have to manually stop it. The animation was used as a test to check how the drunks were moving so code was not added to ensure it stopped at the correct point. However, this could be developed as an improvement to make watching the animation easier and a naturally incorporated part of the process. Secondly, the retargeting process which ensures the drunks can move round the buildings effectively is not the most efficient solution and causes drunks to become stuck at perimeters for longer than desired. This also means there is a bias towards drunks who live at the bottom half of the map arriving home first. Improvements could be made to incorporate pathfinding elements into the code. However, at my current level a trade-off of having a slightly more inefficient walk was worthwhile due to the complexity of pathfinding. Another, simpler, solution could be allowing drunks to access their home from any point rather than the ‘door’, but this felt less realistic and would remove an aspect of the code which was challenging and rewarding. Finally, the distance threshold is hard coded to 50. This is not problematic for the given project but influences replicability. Improvements could be made to base the distance off the given plan which would ensure the code was more adaptable to other given data structures. 



### **Sources** 

In the visualization process, a lot of guidance was given from stack overflow to help with plotting rectangles and text. This was the case particularly when it came to animation. Some code was taken from the first assignment, for example, I reused my own code which moves the drunk to their door (in the first practical this moved a wolf to the sheep), copied in the code which read in the external plan, and reused aspects of the animation code. I also referred to the matplotlib source code on several occasions to aid with plotting and animations. Finally, to familiarise myself with dictionaries and numpy arrays I completed a few short python courses on DataCamp.



### **Development Process**

The first stage of the project was reading in the drunk plan file provided and visualising it for reference. It was then clear that the houses and pub were not one coordinate point but had perimeters that spread across multiple points. I then wanted to isolate these sets of coordinates with their associated house number so I could create my own plot. I first looped over the plan file, enumerating to retrieve the indices of the pub and house points and saving these as coordinates alongside the value. This format held too many repeat values, as each set of coordinates only needed to be matched to one copy of its associated number. A dictionary was then created, an appropriate format to hold individual house numbers as the keys and lists of tuples containing coordinates as the value. The pub values were saved in a list of tuples instead of a dictionary, as there was only one pub, so no key value was required. Before I moved on to making classes, I looked up a way to plot squares in matplotlib and found the rectangles method. It required the bottom left point, width, and height of the rectangle. I then knew what the best information to gather was when ‘building’ my houses and pubs in a class. 

I created a House class which took the coordinates of the building and the number as positional arguments (which could be provided from my dictionary). I then calculated the building’s bottom left, width, and height as properties so it would be easy to plot the rectangle. I knew I wanted the drunks to exit the pub and enter the houses at specific points, so I calculated the midway point of the width and added a door. After repeating this process for the pub, I realised the code was almost identical (other than the number argument) so I created a super class called Building, the two further sub classes, House and Pub. I plotted the bottom left and top right points, along with house numbers and labels, to ensure they were calculated correctly and matched the layout of the initial figure. 

It was now time to make some drunks! I knew the drunks would need access to the house for the number and door, and the pub for the door, so initialised them with these parameters, alongside x and y values. They would also need access to the drunks list to remove themselves from it when they reached home, and access to the plan to check the points which they weren’t allowed to walk (any value wasn’t equal to 0 on the original plan). I created a drunk per house in the model code and set the x and y values to the pub’s door as this would be their initial starting point. I created a random walk method which moved the drunks at random and animated the drunks’ movement so I could visualise them. This initial animation process was difficult as it required me to look into how to animate using rectangles and text. Initially I couldn’t get the rectangles to plot until I found the plt.gca() method, which effectively plotted the buildings and text. 

I noticed that the drunks were walking through the pub so remembered to add boundary checks to prevent this, and to ensure they didn’t try to walk past the perimeters of the plan. I initially copied my boundary check from assignment 1, which allowed the drunks to move to the spot then corrected for that before plotting and added the aspect to check for buildings. This seemed to work, but when I ran the movement for 1000 iterations, I got an error. The drunks would try and move beyond the boundary, then when they were completing the building check, the point they were at was beyond the contents of the plan (which they referred to for the building check). Therefore, both checks needed to be preventative rather than corrective. I ran the code again, this time animating and giving the drunks initial x and y coordinates close to the perimeter. They bounced off appropriately. 

I then wanted to add a more direct aspect to their walk, creating a walk directly home method. Visualizing this, I noticed the drunks got stuck on the perimeters of their house if they had to go round the building to access the door. I incorporated some randomness into the walk and the problem continued as every time they moved away, they were pulled back to the blockage due to the direct walk. After trialling several different methods (adding more randomness at points, moving in a certain direction when blocked) I still couldn’t get the drunks at the bottom of the map to reach their doors. I considered moving the doors to the top of the house so they could avoid walking round the house, but this didn’t feel right. I decided to add a ‘retargeting’ stage that would happen if the drunk was unable to move due to blockage. This consisted of the drunk finding another target (initially set as the door) in the radius of the door, moving there, and trying again to access the door.  This meant they could come at it from a different angle and potentially not get stuck. Randomness was still kept in at this stage to ensure the walk still appeared to represent that of a drunk person’s, and after animating the movement it looked good, but another issue was discovered. As the drunks were blocked from accessing any point which was marked with a number other than 0 on the plan, they couldn't access their front door to remove themselves from the list. I created an exception to this in the code, ran the animation again, and watched all the drunks successfully move home.

As a final step in developing the movement I wanted to make the walk more interesting, so ensured it was more random the further the drunks were from home. If their distance was 50 or above they walked with 90% chance of randomness and 10% direct, then when it was below 50 they walked with 30% randomness and 70% direct. I kept some directness in their initial walk as even if they were very drunk, they’d still know the general direction. And I maintained randomness in their direct walk as they were still drunk and would stumble or lose their way every once in a while. 

Finally, the routes taken by the drunks needed to be presented as a heat map and written out to a file. I created a nested list full of 0’s which matched the perimeters of the plan and added a method to the drunk class which adds 1 the spot it passes. I then plotted this information and noticed the heat map was not initially very visually interesting. The most visited spots completely overwhelmed the individual paths, so I converted the list to a numpy array and applied a logarithm to give the higher values less weight. This scaled the values and resulted in a much nicer and clearer heat map. I then wrote this file out to a csv. 



### **Tests**

Doctests were used to test aspects of the code. A method was made to read in a csv text file and tested based on the length on the file, ensuring it read in rows and columns appropriately. The method used to create the empty list which drunks add to as they walk was tested to ensure the dimensions of the list were correct. The distance calculation which was utilised to check how close the drunks were to home was tested using random points. The method used to calculate building attributes were also tested, creating a random list or coordinates and checking the bottom left, top right, width, and door. 


